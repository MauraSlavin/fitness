let currentWO="";function renderPage(){$.get("api/workout/populated",e=>{if(0==e.length)handleNoCurrentWO();else{const t=(currentWO=e[0]).exercises;$("#workoutName").text(currentWO.name);let r=t.map(e=>e._id);putExercisesOnHtml({currentExercises:t,exerIndicesInWO:r}),updateStatus()}})}function handleNoCurrentWO(){console.log("ERROR:  There should be a current workout, and there isn't."),window.location.href="./index.html"}function putExercisesOnHtml({currentExercises:e,exerIndicesInWO:t}){$(".execInWOTableRow").remove(),$(".execTableRow").remove(),$.get("api/exercises",r=>{r.forEach(r=>{appendExercises(r),appendWOExercises({exercise:r,exerIndicesInWO:t,currentExercises:e})})}).catch(e=>{console.log(e)})}function appendExercises(e){let t;t='<tr class="execTableRow">',t+=`<td>${e.description}</td>`,t+=`<td>${e.unit}</td>`,t+=`<td>${e.reps}</td>`,t+='<td><button class="btn btn-warning addExerToWO" ',t+=`data-id="${e._id}" `,navigator.onLine||(t+='disabled="disabled" '),t+='type="submit">Add</button></td>',t+="</tr>",$(".allExercises").append(t)}function appendWOExercises({exercise:e,exerIndicesInWO:t,currentExercises:r}){let n=t.reduce(function(t,r,n){return r===e._id&&t.push(n),t},[]);for(let t=0;t<n.length;t++){let o;const c=r[o=n[t]].whenDone;execInWORow='<tr class="execInWOTableRow">',execInWORow+=`<td>${e.description}</td>`,execInWORow+=`<td>${e.unit}</td>`,execInWORow+=`<td>${e.reps}</td>`,execInWORow+=`<td>${c}</td>`,execInWORow+="</tr>",$(".addExercisesInWO").prepend(execInWORow)}}function updateStatus(){if(navigator.onLine)$(".offline").remove(),$(".addExerToWO").attr("disabled",!1),$(".createNewExercise").attr("disabled",!1);else{const e='<p class="offline">You are now offline.  You can see the list of workouts, and the current workout, but you cannot add or change workouts or exercises.  Thank you for your patience.</p>';$("h3").append(e),$(".addExerToWO").attr("disabled",!0),$(".createNewExercise").attr("disabled",!0)}}function createExercise(){let e=$("#exercise").val().trim(),t=$("#unit").val().trim(),r=$("#reps").val().trim();""!==e?(""===t&&(t="1"),""===r&&(r="1"),$("#exercise").val(""),$("#unit").val(""),$("#reps").val(""),$.ajax({method:"POST",url:`api/exercise/${e}/${t}/${r}`}).then(e=>{renderPage()}).catch(e=>{console.log(e)})):$("#exercise").val("Exercise name required")}function addExerciseToWorkout(e){$.ajax({method:"PUT",url:`api/workout/${currentWO._id}/${e}`}).then(e=>{renderPage()}).catch(e=>{console.log(e)})}$(document).ready(()=>{renderPage(),window.scrollTo(0,0),window.addEventListener("online",updateStatus),window.addEventListener("offline",updateStatus),$(".allExercises").on("click",".addExerToWO",function(e){addExerciseToWorkout($(this).data("id"))}),$(".createNewExercise").on("click",()=>{createExercise()})});